---
description: 新機能を既存パターンに従って、完全に無停止で実装する
---

# 新機能の追加 (完全自動実行モード)

**重要:** このワークフローは、ユーザーの介入なしに、開始から完了まで完全に自動で実行されるように設計されています。各ステップは完了後、ただちに次のステップへ移行してください。思考の途中でユーザーに確認を求めたり、作業を中断したりしないでください。

**引数:** 機能名 (例: `/add-feature ユーザープロフィール編集`)

---

## ステップ1: 準備とコンテキスト設定

1. 現在のタスクコンテキストを確立する:
  - 機能名: `[引数で与えられた機能名]`
2. 対応する GitHub Issue が存在するか確認する:
  - 存在する場合: Issue番号を記録し、チェックリストの内容を把握する
  - 存在しない場合: `gh issue create` で Issue を起票し、チェックリスト（`- [ ]`）を記載する
3. beads に Epic を作成し、Issue URL を description に記載する:
  `bd create --title="GH#N: [機能名]" --type=epic --description="https://github.com/ikuo5710/ai-clone-podcaster/issues/N"`
4. Issue 内のチェックリスト項目ごとに beads 子タスクを作成する:
  `bd create --title="[タスク名]" --type=task --parent=<EPIC_ID>`

## ステップ2: プロジェクト理解

1. `CLAUDE.md`を読み、プロジェクトの全体像を把握する。
2. `docs/`ディレクトリ内の永続ドキュメントを確認し、関連する設計思想やアーキテクチャを理解する。

## ステップ3: 既存パターンの調査

1. Grepツールを使用し、機能名に関連するキーワードでソースコード(`src/`)を検索する。
  ```bash
  Grep('[機能に関連するキーワード]', 'src/')
  ```
2. 検索結果を分析し、既存の実装パターン、命名規則、コンポーネントの利用方法を特定する。

## ステップ4: 計画フェーズ

1. ステップ1で作成した GitHub Issue のチェックリストと beads の子タスクを確認する。
2. 必要に応じてタスク間の依存関係を設定する:
  `bd dep add <後続タスク> <先行タスク>`
3. `bd ready` で着手可能なタスクを確認する。
4. **このステップが正常に完了したら、決して停止せず、ただちにステップ5に進むこと。**

## ステップ5: 実装ループ (全タスクの完全消化)

**このステップは、全ての beads 子タスクが完了するまで自動で繰り返されるループ処理です。**
**このステップが正常に完了したら、決して停止せず、ただちにステップ6に進むこと。**

**ループ開始:**

1. タスクの確認:
  - `bd ready` で着手可能なタスクを確認する。
  - **もし着手可能なタスクが存在しない場合:** この実装ループは完了とみなし、ただちに**ステップ6**へ進む。
  - **もし着手可能なタスクが存在する場合:** 次の処理（2. タスクの実行）に進む。

2. タスクの実行:
  - 着手するタスクのステータスを更新する: `bd update <ID> --status=in_progress`
  - そのタスクを完了させるために必要な実装作業を実行する。
  - `Skill('development-guidelines')`のコーディング規約を常に遵守する。

3. タスクの完了:
  - 実行したタスクが完了したら: `bd close <ID> --reason="[完了理由]"`
  - GitHub Issue のチェックリストも更新する（`gh issue edit` で `- [ ]` → `- [x]`）

4. ループ継続:
  - **ステップ5の先頭 (1. タスクの確認) に戻り、処理を繰り返す。**

---
### ※ 実装ループ内の例外処理ルール ※

実装ループの実行中に以下の状況が発生した場合は、このルールに従って自律的に対処し、ループを継続すること。

- **ルールA: タスクが大きすぎる場合**
  - **対処法:** 現在のタスクをより小さな複数の beads 子タスクに分割する。GitHub Issue のチェックリストも対応させて更新する。その後、ループを継続する。

- **ルールB: 技術的理由でタスクが不要になった場合**
  - **条件:** 実装方針の変更、アーキテクチャの変更、依存関係の変更など、明確な技術的理由がある場合にのみ適用。
  - **対処法:** beads のコメントに理由を記録し、タスクをクローズする: `bd close <ID> --reason="不要: [技術的理由]"`。GitHub Issue のチェックリストも対応させて更新する。その後、ループを継続する。

- **❌ 絶対禁止の行為:**
  - 未完了タスクを「後でやる」「別タスクにする」などの理由で意図的にスキップすること。
  - 理由なく未完了タスクを放置してループを終了させること。
  - ユーザーに判断を仰ぐこと。

---

## ステップ6: 実装検証 (サブエージェント起動)

1. 全ての beads 子タスクが完了したことを最終確認する。
2. `Task`ツールを使用し、`implementation-validator`サブエージェントを起動して品質を検証する。
  - `subagent_type`: "implementation-validator"
  - `description`: "Implementation quality validation"
  - `prompt`: "今回実装した `[機能名]` に関する全ての変更点の品質を検証してください。対象ファイルは `[実装したファイルのパスリスト]` です。コーディング規約、エラーハンドリング、テスト可能性、既存パターンとの整合性を重点的に確認してください。"

**このステップが正常に完了したら、決して停止せず、ただちにステップ7に進むこと。**

## ステップ7: 自動テストの実行

1. 以下のコマンドを順番に実行し、全てのテストがパスすることを確認する。
  ```bash
  Bash('npm test')
  Bash('npm run lint')
  Bash('npm run typecheck')
  ```
2. いずれかのコマンドでエラーが発生した場合は、問題を分析し、修正コードを生成・適用してから、再度このステップを実行する。

**このステップが正常に完了したら、決して停止せず、ただちにステップ8に進むこと。**

## ステップ8: ドキュメント更新と beads 記録

1. 今回の変更がプロジェクトの基本設計やアーキテクチャに影響を与えるか判断する。
2. 影響がある場合、`docs/`内の関連する永続ドキュメントを`Edit`ツールで更新する。
3. beads Epic をクローズする: `bd close <EPIC_ID> --reason="[完了サマリー]"`
4. 意思決定や学びがあれば beads コメントに記録する:
  - `bd comments add <EPIC_ID> "DECISION: …"`
  - `bd comments add <EPIC_ID> "LEARNED: …"`

## 完了条件

このワークフローは、以下の全ての条件を満たした時点で自動的に完了となる。
- ステップ5: 全ての beads 子タスクが完了している。
- ステップ6: `implementation-validator`サブエージェントの検証をパスする。
- ステップ7: `test`, `lint`, `typecheck`の全てのコマンドがエラーなく成功する。
- ステップ8: beads Epic がクローズされ、必要なドキュメント更新が完了している。

この完了条件を満たすまで、自律的に思考し、問題解決を行い、作業を継続すること。
